{"version":3,"file":"contentScript.ts-DBjKCxlH.js","sources":["../../src/contentScript.ts"],"sourcesContent":["/**\n * Content script responsibilities:\n * 1) Inject inpage provider into the page context\n * 2) Bridge window.postMessage <-> chrome.runtime messaging\n */\n\nfunction injectInpage() {\n  const src = chrome.runtime.getURL(\"src/inpage.ts\")\n  const s = document.createElement(\"script\")\n  s.setAttribute(\"src\", src)\n  s.setAttribute(\"type\", \"module\")\n  s.onload = () => s.remove()\n  ;(document.head || document.documentElement).appendChild(s)\n}\n\ninjectInpage()\n\n// Forward dapp -> background\nwindow.addEventListener(\"message\", async (event) => {\n  if (event.source !== window) return\n  const msg = event.data\n  if (!msg || msg.type !== \"OMNI_WALLET_REQUEST\") return\n\n  const { id, method, params } = msg\n  const origin = window.location.origin\n\n  try {\n    const resp = await chrome.runtime.sendMessage({\n      type: \"RPC_REQUEST\",\n      id,\n      origin,\n      method,\n      params\n    })\n    window.postMessage(\n      {\n        type: \"OMNI_WALLET_RESPONSE\",\n        id,\n        result: resp?.result,\n        error: resp?.error\n      },\n      \"*\"\n    )\n  } catch (e: any) {\n    window.postMessage(\n      {\n        type: \"OMNI_WALLET_RESPONSE\",\n        id,\n        result: null,\n        error: e?.message ?? String(e)\n      },\n      \"*\"\n    )\n  }\n})\n\n// Forward background -> dapp events\nchrome.runtime.onMessage.addListener((msg) => {\n  if (msg?.type === \"OMNI_EVENT\") {\n    window.postMessage(\n      {\n        type: \"OMNI_WALLET_EVENT\",\n        event: msg.event,\n        payload: msg.payload\n      },\n      \"*\"\n    )\n  }\n})\n"],"names":["injectInpage","src","s","event","msg","id","method","params","origin","resp"],"mappings":"AAMA,SAASA,GAAe,CACtB,MAAMC,EAAM,OAAO,QAAQ,OAAO,eAAe,EAC3CC,EAAI,SAAS,cAAc,QAAQ,EACzCA,EAAE,aAAa,MAAOD,CAAG,EACzBC,EAAE,aAAa,OAAQ,QAAQ,EAC/BA,EAAE,OAAS,IAAMA,EAAE,OAAA,GACjB,SAAS,MAAQ,SAAS,iBAAiB,YAAYA,CAAC,CAC5D,CAEAF,EAAA,EAGA,OAAO,iBAAiB,UAAW,MAAOG,GAAU,CAClD,GAAIA,EAAM,SAAW,OAAQ,OAC7B,MAAMC,EAAMD,EAAM,KAClB,GAAI,CAACC,GAAOA,EAAI,OAAS,sBAAuB,OAEhD,KAAM,CAAE,GAAAC,EAAI,OAAAC,EAAQ,OAAAC,CAAA,EAAWH,EACzBI,EAAS,OAAO,SAAS,OAE/B,GAAI,CACF,MAAMC,EAAO,MAAM,OAAO,QAAQ,YAAY,CAC5C,KAAM,cACN,GAAAJ,EACA,OAAAG,EACA,OAAAF,EACA,OAAAC,CAAA,CACD,EACD,OAAO,YACL,CACE,KAAM,uBACN,GAAAF,EACA,OAAQI,GAAA,YAAAA,EAAM,OACd,MAAOA,GAAA,YAAAA,EAAM,KAAA,EAEf,GAAA,CAEJ,OAAS,EAAQ,CACf,OAAO,YACL,CACE,KAAM,uBACN,GAAAJ,EACA,OAAQ,KACR,OAAO,iBAAG,UAAW,OAAO,CAAC,CAAA,EAE/B,GAAA,CAEJ,CACF,CAAC,EAGD,OAAO,QAAQ,UAAU,YAAaD,GAAQ,EACxCA,GAAA,YAAAA,EAAK,QAAS,cAChB,OAAO,YACL,CACE,KAAM,oBACN,MAAOA,EAAI,MACX,QAASA,EAAI,OAAA,EAEf,GAAA,CAGN,CAAC"}